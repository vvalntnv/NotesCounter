# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Solana blockchain application built with the Anchor framework (v0.32.1). The project implements a note-taking system with a global counter service that tracks note statistics across users.

## Architecture

The project consists of two Solana programs:

1. **app_program** (`8b3Co1nvrEdyeA5tKCoLNd5kgxedGRxY333SvdqviyA7`): Main application program that handles note operations
   - Manages note creation, editing, and listing
   - State: `NoteData` accounts with content, last_edited timestamp, and note_id
   - Instructions: `create_note`, `edit_note`, `list_notes`

2. **counter_service** (`RU8qag4xkWaDZA4edLmxmNbCUAzWbevWqFnJVTX1kSS`): Global service for tracking statistics
   - Tracks user-level counters and note statistics
   - Designed to be called via CPI (Cross-Program Invocation) from app_program
   - State modules: `user_counter`, `note_stats` (currently stubs)
   - Instructions: `increment_on_create`, `increment_on_edit` (currently stubs)

### Cross-Program Invocation Pattern

The app_program is designed to invoke counter_service via CPI to track statistics when notes are created or edited. This demonstrates the Solana pattern of composable programs where one program calls another.

## Development Commands

### Build
```bash
anchor build
```

### Testing
Run all tests:
```bash
anchor test
# or via npm script
yarn run test
```

The test command uses ts-mocha with a 1000-second timeout and runs all `.ts` files in the `tests/` directory.

### Linting
```bash
yarn run lint        # Check formatting
yarn run lint:fix    # Auto-fix formatting issues
```

Uses Prettier to format JavaScript and TypeScript files.

### Local Deployment
The project is configured for localnet deployment:
```bash
anchor localnet
```

The wallet is located at `~/.config/solana/id.json`.

## Project Structure

```
programs/
├── app_program/          # Main application logic
│   └── src/
│       ├── lib.rs        # Program entry point
│       ├── instructions/ # Instruction handlers
│       └── state/        # Account state definitions
└── counter_service/      # Statistics tracking service
    └── src/
        ├── lib.rs        # Program entry point (mostly stub)
        ├── instructions/ # CPI handlers (stubs)
        └── state/        # Counter state (stubs)

tests/                    # TypeScript integration tests
migrations/              # Deployment scripts
```

## Program IDs

Program IDs are declared in `Anchor.toml` and `lib.rs` files:
- app_program: `8b3Co1nvrEdyeA5tKCoLNd5kgxedGRxY333SvdqviyA7`
- counter_service: `RU8qag4xkWaDZA4edLmxmNbCUAzWbevWqFnJVTX1kSS`
- global_counter_service: `F3q6Gg8Rw7oMLYUEnzKV31mDgBCetezcEjPnoDYE2NL`

## TypeScript Testing Environment

Tests use:
- `@coral-xyz/anchor` for Solana/Anchor interaction
- Mocha as the test framework
- Chai for assertions
- ts-mocha for TypeScript support

The test file imports program types from `target/types/` which are auto-generated by Anchor during build.

## Important Notes

- The counter_service program currently has stub implementations - the state modules and instruction handlers are empty files
- The create_note handler in app_program appears incomplete (line 14 shows `pub fn handler(ctx: Context);` without implementation)
- This appears to be a work-in-progress project demonstrating multi-program architecture on Solana
